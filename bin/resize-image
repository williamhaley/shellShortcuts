#!/usr/bin/env bash

width=-1
height=-1
ratio=1
file=""
compression=2 # 31 is worst quality. 10 seems decent for web images, but will vary

while getopts "w:f:h:r:c:" opt;
do
  case ${opt} in
    w)
      width=$OPTARG
      ;;
    h)
      height=$OPTARG
      ;;
    r)
      ratio=$OPTARG
      ;;
    f)
      file=$OPTARG
      ;;
    c)
      compression=$OPTARG
      ;;
  esac
done
shift $((OPTIND -1))

if [ -z "$file" ];
then
    echo "must specify file with -f"
    exit 1
fi

vf=""
if [ "$ratio" != "1" ];
then
    vf="scale=iw*${ratio}:ih*${ratio}"
else
    vf="scale=${width}:${height}"
fi

set -x
ffmpeg -i "${file}" -qscale:v "${compression}" -vf "${vf}" "${file}"

