#!/usr/bin/env bash

# Stream the desktop (with audio) from Linux over HTTP.
#
# For now the only easy way to open this is with vlc. Just open the network
# stream from there on the client machine using the http://wherever:port. Seems
# like the muxing results in an MPEG2-TS stream, which maybe is not easy to
# read in HTTP web clients.

port=8080
host=0.0.0.0

# These should be specific to the screen served.
width=1920
height=1080
# Scaled to half size.
width=960
height=540

# https://superuser.com/questions/335885/stream-desktop-using-vlc
# https://www.youtube.com/watch?v=CxbPhDv9xds
#
# Change to alsa:// (or whatever is appropriate) if not using pulse audio.
cvlc \
    screen:// \
    :screen-fps=30 \
    :screen-caching=100 \
    :input-slave=pulse:// \
    --sout "#transcode{acodec=mp3,vcodec=h264,vb=4096,acodec=mpga,ab=256,scale=1,width=1920,height=1080}:standard{access=http,mux=ts,dst=${host}:${port}}"
