#!/usr/bin/env bash

# Use -d as a portable flag across Unix/Linux
dir=$(mktemp -d)

ffmpeg \
	-i "${1}" \
	-vf fps=15,scale=320:-1:flags=lanczos,palettegen \
	"${dir}/palette.png"

ffmpeg \
	-i "${1}" -i "${dir}/palette.png" \
	-filter_complex "fps=15,scale=400:-1:flags=lanczos[x];[x][1:v]paletteuse" \
	output.gif
