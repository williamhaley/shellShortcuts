#!/usr/bin/env bash

if [[ $EUID -ne 0 ]];
then
	echo "This script must be run as root"
	exit 1
fi

interrupt()
{
	echo "Script interrupted."
	exit 1
}

trap interrupt INT

do_rsync()
{
	rsync_opts="--delete-excluded --delete-after"

	echo
	echo "rsync: $1 ==> $2"
	echo

	wrsync ${rsync_opts} "$1" "$2"
}

small-backup()
{
	if `findmnt -M "/mnt/$1" >/dev/null`;
	then
		do_rsync /home/will/Documents/   "/mnt/$1/Documents/"
		do_rsync /home/will/Photographs/ "/mnt/$1/Photographs/"
		do_rsync /home/will/.electrum/   "/mnt/$1/electrum/"
		do_rsync /home/will/.bitcoin/    "/mnt/$1/bitcoin/"
	else
		echo
		echo "/mnt/$1 not mounted"
		echo
	fi
}

medium-backup()
{
	if `findmnt -M "/mnt/$1" >/dev/null`;
	then
		do_rsync /home/will/Documents/   "/mnt/$1/Documents/"
		do_rsync /home/will/Photographs/ "/mnt/$1/Photographs/"
		do_rsync /home/will/.electrum/   "/mnt/$1/electrum/"
		do_rsync /home/will/.bitcoin/    "/mnt/$1/bitcoin/"
		do_rsync /home/will/Music/       "/mnt/$1/Music/"
	else
		echo
		echo "/mnt/$1 not mounted"
		echo
	fi
}

large-backup()
{
	if `findmnt -M "/mnt/$1" >/dev/null`;
	then
		do_rsync "/home/will/Photographs/"    "/mnt/$1/willhaley-backup/Photographs/"
		do_rsync "/home/will/Music/"          "/mnt/$1/willhaley-backup/Music/"
		do_rsync "/home/will/Documents/"      "/mnt/$1/willhaley-backup/Documents/"
		do_rsync "/home/will/.ssh/"           "/mnt/$1/willhaley-backup/ssh/"
		do_rsync "/home/will/.aws/"           "/mnt/$1/willhaley-backup/aws/"
		do_rsync "/home/will/Desktop/"        "/mnt/$1/willhaley-backup/Desktop/"
		do_rsync "/home/will/Downloads/"      "/mnt/$1/willhaley-backup/Downloads/"
		do_rsync "/home/will/dev/"            "/mnt/$1/willhaley-backup/dev/"
		do_rsync "/home/will/.electrum/"      "/mnt/$1/willhaley-backup/electrum/"
		do_rsync "/home/will/.bitcoin/"       "/mnt/$1/willhaley-backup/bitcoin/"
		do_rsync "/home/will/.config/rclone/" "/mnt/$1/willhaley-backup/rclone/"
		do_rsync "/etc/crypttab"              "/mnt/$1/system-backup/crypttab"
		do_rsync "/etc/fstab"                 "/mnt/$1/system-backup/fstab"
		do_rsync "/etc/default/cryptdisk"     "/mnt/$1/system-backup/cryptdisk"
	else
		echo
		echo "/mnt/$1 not mounted"
		echo
	fi
	
	if `findmnt -M "/mnt/data" >/dev/null`;
	then
		do_rsync /mnt/data/Software/     "/mnt/$1/Software/"
		do_rsync /mnt/data/Videos/       "/mnt/$1/Videos/"
		do_rsync /mnt/data/FamilyPhotos/ "/mnt/$1/FamilyPhotos/"
	else
		echo
		echo "/mnt/data not mounted"
		echo
	fi
}

small-backup "horcrux1"
small-backup "horcrux2"
medium-backup "escape-pod"
large-backup "backup-internal"

