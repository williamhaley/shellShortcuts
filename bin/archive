#!/usr/bin/env bash

[ $EUID -ne 0 ] && echo "run as root" >&2 && exit 1

if ! `findmnt -M "/mnt/backup-internal" >/dev/null`;
then
	echo "/mnt/backup-internal is not mounted"
	exit 1
fi

interrupt()
{
	echo "Script interrupted."
	exit 1
}

trap interrupt INT

rsync_opts="--delete-excluded --delete-after"

if `findmnt -M "/mnt/backup-external" >/dev/null`;
then
	wrsync ${rsync_opts} /mnt/backup-internal/ /mnt/backup-external/
else
	echo "/mnt/backup-external is not mounted"
	exit 1
fi

