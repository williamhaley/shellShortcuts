#!/usr/bin/env bash

if [[ $EUID -ne 0 ]];
then
	echo "This script must be run as root"
	exit 1
fi

if ! `findmnt -M "/mnt/backup-internal" >/dev/null`;
then
	echo "Disk not mounted"
	exit 1
fi

interrupt()
{
	echo "Script interrupted."
	exit 1
}

trap interrupt INT

rsync_opts="--delete-excluded --delete-after"

if `findmnt -M "/mnt/backup-external" >/dev/null`;
then
	wrsync ${rsync_opts} /mnt/backup-internal/ /mnt/backup-external/
else
	echo
	echo "/mnt/backup-external not found"
	echo
	exit 1
fi

