#!/usr/bin/env bash

for APP in `ls $1`;
	do (
		if [ ! -d "${1}/${APP}" ];
		then
			continue
		fi

		cd "$1/$APP"
		if [ -d ".git" ];
		then
			git submodule update --init --recursive > /dev/null 2>&1
			git pull --rebase > /dev/null 2>&1
		fi
	) &
done

wait

for APP in `ls $1`;
	do (
		if [ ! -d "${1}/${APP}" ];
		then
			continue
		fi

		cd "$1/$APP"
		if [ -d ".git" ];
		then
			printf "${APP}: "
			printfgreen "[$(git currentbranch)] "
			git isdirty && printfred "dirty"
			git hasstash && printfyellow "stash"

			numbranches=$(git branch | wc -l | sed 's/^ *//;s/ *$//')
			printf "\nbranches: "
			if [ "$numbranches" -gt "1" ];
			then
				printfcyan "${numbranches}\n"
			else
				printf "${numbranches}\n"
			fi
			echo ""
		fi
	)
done

